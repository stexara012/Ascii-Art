<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Automatic Colored ASCII Art with Palette Picker</title>
<style>
body {
    font-family: monospace;
    background-color: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    transform-origin: top center;
    transition: transform 0.5s ease;
}
#ascii, #asciiHTML {
    white-space: pre;
    line-height: 2px;
    font-size: 4px;
    margin-top: 20px;
    max-width: 100%;
    overflow-x: auto;
    background-color: #222;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
}
.slider-container, .color-picker-container {
    margin: 10px 0;
}
label {
    margin-right: 10px;
}
button {
    margin-top: 10px;
    padding: 5px 10px;
    font-size: 14px;
    cursor: pointer;
}
#previewContainer {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
}
.color-picker {
    width: 50px;
    height: 30px;
    border: none;
    margin-right: 5px;
    cursor: pointer;
}
.palette-row {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    justify-content: center;
    flex-wrap: wrap;
}
.palette-btn {
    padding: 6px 10px;
    border: 1px solid #444;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    background-color: #333;
    color: #fff;
    transition: transform 0.1s ease, background-color 0.2s ease;
}
.palette-btn:hover {
    background-color: #555;
}
.palette-btn:active {
    transform: scale(0.95);
    background-color: #777;
}
#legend {
    margin-top: 10px;
    background-color: #222;
    padding: 10px;
    border-radius: 5px;
    font-size: 12px;
}
</style>
</head>
<body>
<h1>ASCII Art with Interactive Color Palette</h1>
<input type="file" id="imageInput" accept=".png, .jpg, .jpeg">

<div class="slider-container">
    <label>Width (ASCII chars):</label>
    <input type="range" id="widthSlider" min="200" max="400" value="300">
</div>

<div class="slider-container">
    <label>Image Crop (% of height):</label>
    <input type="range" id="cropSlider" min="30" max="100" value="100">
</div>

<div class="slider-container">
    <label>Brightness:</label>
    <input type="range" id="brightness" min="-100" max="100" value="0">
</div>
<div class="slider-container">
    <label>Contrast:</label>
    <input type="range" id="contrast" min="-100" max="100" value="0">
</div>
<div class="slider-container">
    <label>Sharpness:</label>
    <input type="range" id="sharpness" min="0" max="5" step="0.1" value="0">
</div>

<div class="slider-container">
    <label>Export Scale:</label>
    <input type="range" id="exportScale" min="0.2" max="1.0" step="0.1" value="0.5">
    <span id="scaleValue">0.5Ã—</span>
</div>

<div class="color-picker-container">
    <label>Custom Palette:</label>
    <input type="color" class="color-picker" value="#000000">
    <input type="color" class="color-picker" value="#4B0082">
    <input type="color" class="color-picker" value="#800080">
    <input type="color" class="color-picker" value="#9400D3">
    <input type="color" class="color-picker" value="#8A2BE2">
    <input type="color" class="color-picker" value="#9370DB">
    <input type="color" class="color-picker" value="#D8BFD8">
    <input type="color" class="color-picker" value="#E6E6FA">
    <button id="applyColors">Apply Palette</button>
    <button id="resetBtn">Reset</button>
</div>

<div class="palette-row">
    <button class="palette-btn" data-palette="red">Red</button>
    <button class="palette-btn" data-palette="blue">Blue</button>
    <button class="palette-btn" data-palette="green">Green</button>
    <button class="palette-btn" data-palette="gold">Gold</button>
    <button class="palette-btn" data-palette="purple">Purple</button>
    <button class="palette-btn" data-palette="mix">Mix</button>
</div>

<div class="palette-row">
    <button class="palette-btn" data-palette="sunset">Sunset</button>
    <button class="palette-btn" data-palette="ocean">Ocean</button>
    <button class="palette-btn" data-palette="forest">Forest</button>
    <button class="palette-btn" data-palette="neon">Neon</button>
    <button class="palette-btn" data-palette="grayscale">Grayscale</button>
    <button class="palette-btn" data-palette="cyberpunk">Cyberpunk</button>
    <button id="randomPalette" class="palette-btn">ðŸŽ¨ Random</button>
</div>

<div class="palette-row" id="customPaletteRow"></div>

<div id="legend"></div>

<div id="previewContainer">
    <div>
        <h3>ASCII Text Preview</h3>
        <pre id="ascii"></pre>
        <button id="saveBtn">Save ASCII</button>
    </div>
    <div>
        <h3>Colored HTML Preview</h3>
        <div id="asciiHTML"></div>
        <button id="saveHTMLBtn">Save HTML</button>
    </div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
const imageInput = document.getElementById('imageInput');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const asciiContainer = document.getElementById('ascii');
const asciiHTMLContainer = document.getElementById('asciiHTML');
const widthSlider = document.getElementById('widthSlider');
const brightnessSlider = document.getElementById('brightness');
const contrastSlider = document.getElementById('contrast');
const sharpnessSlider = document.getElementById('sharpness');
const cropSlider = document.getElementById('cropSlider');
const exportScaleSlider = document.getElementById('exportScale');
const scaleValue = document.getElementById('scaleValue');
const saveBtn = document.getElementById('saveBtn');
const saveHTMLBtn = document.getElementById('saveHTMLBtn');
const colorPickers = document.querySelectorAll('.color-picker');
const applyColorsBtn = document.getElementById('applyColors');
const resetBtn = document.getElementById('resetBtn');
const paletteButtons = document.querySelectorAll('.palette-btn');
const legend = document.getElementById('legend');
const customPaletteRow = document.getElementById('customPaletteRow');

const asciiChars = ['@', '%', '#', '*', '+', ':', '.', '-', ' '];
let colorPalette = Array.from(colorPickers).map(p => p.value);
let img = new Image();
let exportScale = 0.5;
scaleValue.textContent = exportScale + "Ã—";

exportScaleSlider.addEventListener('input', () => {
    exportScale = parseFloat(exportScaleSlider.value);
    scaleValue.textContent = exportScale.toFixed(1) + "Ã—";
});

imageInput.addEventListener('change', function() {
    const file = this.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        img.onload = () => {
            document.body.style.transform = "scale(0.5)";
            drawAscii();
        };
        img.src = e.target.result;
    }
    reader.readAsDataURL(file);
});

[widthSlider, brightnessSlider, contrastSlider, sharpnessSlider, cropSlider].forEach(slider => {
    slider.addEventListener('input', drawAscii);
});

const defaultColors = ['#000000','#4B0082','#800080','#9400D3','#8A2BE2','#9370DB','#D8BFD8','#E6E6FA'];

const predefinedPalettes = {
    red: ['#000000','#330000','#660000','#990000','#CC0000','#FF3333','#FF6666','#FF9999'],
    blue: ['#000022','#000044','#000088','#0000CC','#0033FF','#3366FF','#66A3FF','#99CCFF'],
    green: ['#001100','#003300','#006600','#009900','#00CC00','#33FF33','#66FF66','#99FF99'],
    gold: ['#332200','#664400','#996600','#CC8800','#FFAA00','#FFCC33','#FFE066','#FFF5CC'],
    purple: ['#1A001A','#330033','#660066','#990099','#CC00CC','#E066FF','#EE99FF','#F5CCFF'],
    mix: ['#FF0000','#FF7F00','#FFFF00','#00FF00','#0000FF','#4B0082','#8F00FF','#FFFFFF'],
    sunset: ['#2B0000','#661400','#993300','#CC5500','#FF7700','#FF9900','#FFB347','#FFD580'],
    ocean: ['#001F3F','#003366','#004C99','#0066CC','#0099CC','#33CCCC','#66FFFF','#CCFFFF'],
    forest: ['#0B130A','#1C3B1A','#2E562A','#417E3D','#5CA44C','#7FCA68','#A8E89B','#D4F7C4'],
    neon: ['#000000','#2E0854','#FF00FF','#00FFFF','#39FF14','#FFFF00','#FF1493','#FFFFFF'],
    grayscale: ['#000000','#222222','#444444','#666666','#888888','#AAAAAA','#CCCCCC','#FFFFFF'],
    cyberpunk: ['#0D0221','#550088','#8800FF','#FF0099','#FF003C','#FF6600','#FFD500','#00FFF7']
};

paletteButtons.forEach(btn => {
    const key = btn.getAttribute('data-palette');
    if (!key) return;
    btn.addEventListener('click', () => {
        colorPalette = predefinedPalettes[key];
        colorPickers.forEach((p, i) => p.value = colorPalette[i]);
        drawAscii();
        updateLegend();
    });
});

// ðŸŽ¨ RANDOM PALETTE GENERATOR
function generateRandomPalette() {
    const palette = [];
    for (let i = 0; i < 8; i++) {
        const randomColor = "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
        palette.push(randomColor);
    }
    return palette;
}

document.getElementById('randomPalette').addEventListener('click', () => {
    colorPalette = generateRandomPalette();
    colorPickers.forEach((p, i) => { if (colorPalette[i]) p.value = colorPalette[i]; });
    drawAscii();
    updateLegend();
    addCustomPaletteButton(colorPalette);
});

// âž• DODAJ CUSTOM PALETU
function addCustomPaletteButton(palette) {
    const btn = document.createElement('button');
    btn.className = 'palette-btn';
    btn.textContent = 'Custom ' + (customPaletteRow.children.length + 1);
    btn.style.background = `linear-gradient(90deg, ${palette.join(',')})`;
    btn.addEventListener('click', () => {
        colorPalette = palette;
        colorPickers.forEach((p, i) => p.value = palette[i] || '#000000');
        drawAscii();
        updateLegend();
    });
    customPaletteRow.appendChild(btn);
}

applyColorsBtn.addEventListener('click', () => {
    colorPalette = Array.from(colorPickers).map(p => p.value);
    drawAscii();
    updateLegend();
});

resetBtn.addEventListener('click', () => {
    widthSlider.value = 200;
    brightnessSlider.value = 0;
    contrastSlider.value = 0;
    sharpnessSlider.value = 0;
    cropSlider.value = 100;
    exportScaleSlider.value = 0.5;
    exportScale = 0.5;
    scaleValue.textContent = "0.5Ã—";
    colorPickers.forEach((p, i) => p.value = defaultColors[i]);
    colorPalette = [...defaultColors];
    document.body.style.transform = "scale(1)";
    drawAscii();
    updateLegend();
});

saveBtn.addEventListener('click', () => {
    const text = asciiContainer.textContent;
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ascii_art.txt';
    a.click();
    URL.revokeObjectURL(url);
});

saveHTMLBtn.addEventListener('click', () => {
    const htmlContent = `
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Colored ASCII Art</title>
<style>
body { background-color: #fff; margin: 0; padding: 0; height: 100vh; display: flex; justify-content: center; align-items: flex-start; transform: scale(${exportScale}); transform-origin: top center; }
.container { margin-top: 20px; text-align: center; font-family: monospace; white-space: pre; line-height: 6px; font-size: 6px; color: #fff; }
</style>
</head>
<body>
<div class="container">
${asciiHTMLContainer.innerHTML}
</div>
</body>
</html>`;
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ascii_art.html';
    a.click();
    URL.revokeObjectURL(url);
});

function applyContrast(value, color) {
    const factor = (259 * (value + 255)) / (255 * (259 - value));
    return Math.min(255, Math.max(0, factor * (color - 128) + 128));
}

function drawAscii() {
    if (!img.src) return;
    const width = parseInt(widthSlider.value);
    const cropPercent = parseInt(cropSlider.value);
    const visibleHeight = (img.height * cropPercent) / 100;
    const scale = width / img.width;
    const height = Math.floor(visibleHeight * scale);

    canvas.width = width;
    canvas.height = height;

    ctx.drawImage(img, 0, 0, img.width, visibleHeight, 0, 0, width, height);
    let imageData = ctx.getImageData(0, 0, width, height);
    let data = imageData.data;

    const brightness = parseInt(brightnessSlider.value);
    const contrast = parseInt(contrastSlider.value);
    const sharpness = parseFloat(sharpnessSlider.value);

    const kernel = [[0, -1, 0],[-1, 4, -1],[0, -1, 0]];
    let tmpData = new Uint8ClampedArray(data);

    if (sharpness > 0) {
        for (let y = 1; y < height - 1; y++) {
            for (let x = 1; x < width - 1; x++) {
                let sumR = 0, sumG = 0, sumB = 0;
                for (let ky = -1; ky <= 1; ky++) {
                    for (let kx = -1; kx <= 1; kx++) {
                        const i = ((y + ky) * width + (x + kx)) * 4;
                        sumR += tmpData[i] * kernel[ky + 1][kx + 1];
                        sumG += tmpData[i + 1] * kernel[ky + 1][kx + 1];
                        sumB += tmpData[i + 2] * kernel[ky + 1][kx + 1];
                    }
                }
                const idx = (y * width + x) * 4;
                data[idx] = Math.min(255, Math.max(0, tmpData[idx] + sumR * sharpness));
                data[idx + 1] = Math.min(255, Math.max(0, tmpData[idx + 1] + sumG * sharpness));
                data[idx + 2] = Math.min(255, Math.max(0, tmpData[idx + 2] + sumB * sharpness));
            }
        }
    }

    let ascii = '';
    let htmlAscii = '';

    for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
            const offset = (y * width + x) * 4;
            let r = data[offset], g = data[offset + 1], b = data[offset + 2];
            r = Math.min(255, Math.max(0, r + brightness));
            g = Math.min(255, Math.max(0, g + brightness));
            b = Math.min(255, Math.max(0, b + brightness));
            r = applyContrast(contrast, r);
            g = applyContrast(contrast, g);
            b = applyContrast(contrast, b);
            const brightnessVal = 0.299*r + 0.587*g + 0.114*b;
            const charIndex = Math.floor((brightnessVal / 255) * (asciiChars.length - 1));
            const char = asciiChars[charIndex];
            const colorIndex = Math.floor((brightnessVal / 255) * (colorPalette.length - 1));
            const color = colorPalette[colorIndex];
            ascii += char;
            htmlAscii += `<span style="color:${color}">${char}</span>`;
        }
        ascii += '\n';
        htmlAscii += '<br>';
    }

    asciiContainer.textContent = ascii;
    asciiHTMLContainer.innerHTML = htmlAscii;
}

function updateLegend() {
    legend.innerHTML = "<b>ASCII â†’ Color Legend:</b><br>" + 
        asciiChars.map((c, i) => {
            const color = colorPalette[Math.min(i, colorPalette.length - 1)];
            return `<span style="color:${color}">${c}</span> `;
        }).join('');
}

updateLegend();
</script>
</body>
</html>
